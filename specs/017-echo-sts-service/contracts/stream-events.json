{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Stream Events Schema",
  "description": "Socket.IO event schemas for stream lifecycle (spec 016)",
  "definitions": {
    "StreamConfig": {
      "type": "object",
      "properties": {
        "source_language": {
          "type": "string",
          "description": "Source language code (e.g., 'en')",
          "default": "en"
        },
        "target_language": {
          "type": "string",
          "description": "Target language code (e.g., 'es')",
          "default": "es"
        },
        "voice_profile": {
          "type": "string",
          "description": "TTS voice identifier",
          "default": "default"
        },
        "chunk_duration_ms": {
          "type": "integer",
          "minimum": 100,
          "maximum": 5000,
          "description": "Expected fragment duration in milliseconds",
          "default": 1000
        },
        "sample_rate_hz": {
          "type": "integer",
          "enum": [16000, 22050, 44100, 48000],
          "description": "Audio sample rate in Hz",
          "default": 48000
        },
        "channels": {
          "type": "integer",
          "enum": [1, 2],
          "description": "Number of audio channels",
          "default": 1
        },
        "format": {
          "type": "string",
          "enum": ["pcm_s16le", "pcm_f32le"],
          "description": "Audio format",
          "default": "pcm_s16le"
        }
      },
      "required": ["source_language", "target_language"]
    },
    "ServerCapabilities": {
      "type": "object",
      "properties": {
        "batch_processing": {
          "type": "boolean",
          "description": "Whether server supports batch fragment processing",
          "default": false
        },
        "async_delivery": {
          "type": "boolean",
          "description": "Whether server delivers fragments asynchronously",
          "default": true
        }
      },
      "required": ["batch_processing", "async_delivery"]
    },
    "StreamStatistics": {
      "type": "object",
      "properties": {
        "success_count": {
          "type": "integer",
          "minimum": 0
        },
        "partial_count": {
          "type": "integer",
          "minimum": 0
        },
        "failed_count": {
          "type": "integer",
          "minimum": 0
        },
        "avg_processing_time_ms": {
          "type": "number",
          "minimum": 0
        },
        "p95_processing_time_ms": {
          "type": "number",
          "minimum": 0
        }
      },
      "required": ["success_count", "partial_count", "failed_count", "avg_processing_time_ms"]
    }
  },
  "events": {
    "stream:init": {
      "direction": "worker_to_sts",
      "description": "Initialize a new streaming session",
      "payload": {
        "type": "object",
        "properties": {
          "stream_id": {
            "type": "string",
            "description": "Unique stream identifier"
          },
          "worker_id": {
            "type": "string",
            "description": "Worker instance identifier"
          },
          "config": {
            "$ref": "#/definitions/StreamConfig"
          },
          "max_inflight": {
            "type": "integer",
            "minimum": 1,
            "maximum": 10,
            "default": 3,
            "description": "Maximum concurrent fragments"
          },
          "timeout_ms": {
            "type": "integer",
            "minimum": 1000,
            "maximum": 30000,
            "default": 8000,
            "description": "Per-fragment timeout in milliseconds"
          }
        },
        "required": ["stream_id", "worker_id", "config"]
      }
    },
    "stream:ready": {
      "direction": "sts_to_worker",
      "description": "Confirms successful stream initialization",
      "payload": {
        "type": "object",
        "properties": {
          "stream_id": {
            "type": "string"
          },
          "session_id": {
            "type": "string",
            "description": "Server-assigned session ID"
          },
          "max_inflight": {
            "type": "integer",
            "description": "Confirmed max concurrent fragments"
          },
          "capabilities": {
            "$ref": "#/definitions/ServerCapabilities"
          }
        },
        "required": ["stream_id", "session_id", "max_inflight", "capabilities"]
      }
    },
    "stream:pause": {
      "direction": "worker_to_sts",
      "description": "Request temporary pause of fragment processing",
      "payload": {
        "type": "object",
        "properties": {
          "stream_id": {
            "type": "string"
          },
          "reason": {
            "type": "string",
            "description": "Optional reason for pause"
          }
        },
        "required": ["stream_id"]
      }
    },
    "stream:resume": {
      "direction": "worker_to_sts",
      "description": "Resume fragment processing after pause",
      "payload": {
        "type": "object",
        "properties": {
          "stream_id": {
            "type": "string"
          }
        },
        "required": ["stream_id"]
      }
    },
    "stream:end": {
      "direction": "worker_to_sts",
      "description": "Signal end of stream (graceful shutdown)",
      "payload": {
        "type": "object",
        "properties": {
          "stream_id": {
            "type": "string"
          },
          "reason": {
            "type": "string",
            "description": "Optional reason for ending"
          }
        },
        "required": ["stream_id"]
      }
    },
    "stream:complete": {
      "direction": "sts_to_worker",
      "description": "All fragments processed, stream ending gracefully",
      "payload": {
        "type": "object",
        "properties": {
          "stream_id": {
            "type": "string"
          },
          "total_fragments": {
            "type": "integer",
            "minimum": 0
          },
          "total_duration_ms": {
            "type": "integer",
            "minimum": 0
          },
          "statistics": {
            "$ref": "#/definitions/StreamStatistics"
          }
        },
        "required": ["stream_id", "total_fragments", "total_duration_ms", "statistics"]
      }
    }
  }
}
